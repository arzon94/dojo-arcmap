//>>built
define("require exports ../core/tsSupport/extendsHelper ../core/tsSupport/decorateHelper ../core/typescript dojo/_base/lang dojo/when dojo/promise/all dojo/Deferred ../geometry/support/jsonUtils ./core/messageHandler ./core/errorMessages ./core/ExtensionBase ./FeatureActionFeatures".split(" "),function(d,v,p,l,m,q,f,n,g,r,h,e,t,u){d=function(d){function c(){var a=d.call(this)||this;return a.mapWidgetProxy=null,a.mapWidgetId=null,a.dataSourceProxies=null,a.hasFeatureActions=!1,a.hasDefaultFeatureAction=
!1,a.featureActionFeatures=null,a.dataSourceConfigs=null,a}return p(c,d),c.prototype._initializeResponseReceived=function(a){var b=this;return a&&"object"==typeof a||(new g).reject(Error(e.invalidArguments)),this.inherited(arguments).then(function(){b.hasFeatureActions=a.supportFeatureActions;b.hasDefaultFeatureAction=a.supportDefaultFeatureAction;var k=f(b._setupMapWidgetProxy()),c=f(b._setupDataSourceProxies()),d=f(b._setupFeatureActionFeatures());return n([k,c,d])})},c.prototype._setupDataSourceProxies=
function(){var a=this;if(this.dataSourceConfigs||(this.dataSourceConfigs=[]),0!==this.dataSourceConfigs.length){var b=[];return this.dataSourceConfigs.forEach(function(k){b.push(a.getDataSourceProxy(k.dataSourceId))}),n(b).then(function(b){a.dataSourceProxies=b})}},c.prototype._setupMapWidgetProxy=function(){var a=this;if(this.mapWidgetId)return this.getMapWidgetProxy(this.mapWidgetId).then(function(b){a.mapWidgetProxy=b})},c.prototype._setupFeatureActionFeatures=function(){var a=this;if(!this.hasFeatureActions||
0===this.dataSourceConfigs.length)return void(this.featureActionFeatures=null);var b=this.dataSourceConfigs[0].dataSourceId;return this.featureActionFeatures?void(this.featureActionFeatures.dataSourceProxy.id!==b&&(this.featureActionFeatures=null)):this.getDataSourceProxy(b).then(function(b){a.featureActionFeatures=new u(b)})},c.prototype._messageReceived=function(a){switch(a.functionName.toLowerCase()){case "datasourceexpired":case "datasourceupdated":return void this._dataSourceExpired(a.args.dataSourceId);
case "drawcomplete":return void this._drawComplete(a.args)}},c.prototype._dataSourceExpired=function(a){var b=this;this.getDataSourceProxy(a).then(function(a){var c=b.getDataSourceConfig(a);b.dataSourceExpired(a,c);b.emit("data-source-expired",{dataSourceProxy:a,dataSourceConfig:c})})},c.prototype.dataSourceExpired=function(a,b){},c.prototype.getDataSourceConfig=function(a){if(!this._isHostInitialized())throw Error(e.hostNotReady);var b=a;"object"==typeof a&&(b=a.id);for(a=0;a<this.dataSourceConfigs.length;a++)if(this.dataSourceConfigs[a].dataSourceId===
b)return this.dataSourceConfigs[a];return null},c.prototype._dataSourceRemoved=function(a){if(this.inherited(arguments),this.dataSourceConfigs){for(var b=!1,c=0;c<this.dataSourceConfigs.length&&!b;c++)this.dataSourceConfigs[c].dataSourceId===a&&(this.dataSourceConfigs.splice(c,1),b=!0);b&&this._setupFeatureActionFeatures()}},c.prototype._mapWidgetRemoved=function(a){this.inherited(arguments);this.mapWidgetProxy&&this.mapWidgetProxy.id===a&&(this.mapWidgetProxy=null,this.mapWidgetId=null)},c.prototype.activateDrawingToolbar=
function(a,b){if(!this._isHostInitialized())return(new g).reject(Error(e.hostNotReady));if(b||(b=this.mapWidgetProxy),!b)return(new g).reject(Error(e.invalidArguments));var c=b;return"object"==typeof b&&(c=b.id),h._sendMessageWithReply({functionName:"activateDrawingToolbar",args:q.mixin({mapWidgetId:c},a)}).then(function(){return!0},function(){return!1})},c.prototype.deactivateDrawingToolbar=function(a){if(!this._isHostInitialized())throw Error(e.hostNotReady);if(a||(a=this.mapWidgetProxy),!a)throw Error(e.invalidArguments);
var b=a;"object"==typeof a&&(b=a.id);h._sendMessage({functionName:"deactivateDrawingToolbar",args:{mapWidgetId:b}})},c.prototype._drawComplete=function(a){if(a.cancelled)return this.drawingToolbarDeactivated(),void this.emit("drawing-toolbar-deactivated");a=r.fromJSON(a.geometry);this.toolbarDrawComplete(a);this.emit("toolbar-draw-complete",{geometry:a})},c.prototype.toolbarDrawComplete=function(a){},c.prototype.drawingToolbarDeactivated=function(){},c.prototype.executeDefaultFeatureAction=function(a){if(!this._isHostInitialized())throw Error(e.hostNotReady);
if(this.hasDefaultFeatureAction&&Array.isArray(a)&&0!==a.length&&Array.isArray(this.dataSourceProxies)&&0!==this.dataSourceProxies.length){var b=this.dataSourceProxies[0],c=[];a.forEach(function(a){var d=a;if("object"==typeof a){if(!a.attributes||!a.attributes[b.objectIdFieldName])return;d=a.attributes[b.objectIdFieldName]}c.push(d)});0!==c.length&&h._sendMessage({functionName:"executeDefaultFeatureAction",args:{dataSourceId:b.id,objectIds:c}})}},c}(t);return l([m.shared("esri.opsdashboard.WidgetProxy")],
d.prototype,"declaredClass",void 0),d=l([m.subclass()],d)});