//>>built
require({cache:{"url:esri/views/3d/webgl-engine/materials/LeafCardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderLeafCard"\x3e\n\t\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tuniform mat4 modelNormal;\n\n\tuniform vec3 localOrigin;\n\n\tattribute vec3 $position;\n\tattribute vec4 $normal;\n\tattribute vec4 $uv0;\n\tvarying vec2 vtc;\n\tvarying vec3 vnormal;\n\tvarying float ambientLeaf;\n\n\tuniform float trafoScale;\n\tvarying vec3 vpos;\n\n\tvec2 rotate(vec2 pos, float angle) {\n\t\tfloat c \x3d cos(angle);\n\t\tfloat s \x3d sin(angle);\n\t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\n\t}\n\n\tvoid main(void) {\n\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\n\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\n\t\tvec2 uv01 \x3d floor($uv0.xy);\n\t\tvec2 uv \x3d $uv0.xy - uv01;\n\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\n\n\t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w *trafoScale;\n\t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w *trafoScale;;\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\n\t\tgl_Position \x3d pos4;\n\t\tvtc \x3d uv;\n\t\tambientLeaf \x3d normal.w;\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal.xyz, 1.0)).xyz);\n\t}\n]]\x3e\n\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderLeafCard"\x3e\n\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform vec3 camPos;\n\n\tuniform vec3 diffuse;\n\n\tuniform vec3 localOrigin;\n\n\tuniform sampler2D tex;\n\tvarying vec2 vtc;\n\tvarying vec3 vnormal;\n\tvarying float ambientLeaf;\n\n\tvarying vec3 vpos;\n\n\t$sceneLightingDefinitions\n\n\tvoid main() {\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t\tif (texColor.a \x3c .33) discard;\n\n\t\tvec3 normal \x3d normalize(vnormal);\n\t\tvec3 albedo \x3d diffuse * ambientLeaf * texColor.rgb;\n\n\t\tfloat ssao \x3d 1.0;\n\n\t\t$sceneLightingAdditionalLightGlobal\n\n\t\tvec3 color \x3d evaluateSceneLighting(normal, albedo, 1.0, 1.0 - ssao, additionalLight);\n\n\t\tgl_FragColor \x3d vec4(color, texColor.a);\n\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"vertexShaderLeafCardDepth"\x3e\x3c![CDATA[\n    $vsprecisionf\n\n   \tuniform mat4 proj;\n   \tuniform mat4 view;\n   \tuniform mat4 model;\n   \tuniform vec2 nearFar;\n\n   \tattribute vec3 $position;\n   \tattribute vec4 $uv0;\n\n   \tuniform float trafoScale;\n\n   \tvarying vec2 vtc;\n   \tvarying float depth;\n\n   \tvec2 rotate(vec2 pos, float angle) {\n   \t\tfloat c \x3d cos(angle);\n   \t\tfloat s \x3d sin(angle);\n   \t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\n   \t}\n\n   \tvoid main(void) {\n   \t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\n   \t\tvec2 uv01 \x3d floor($uv0.xy);\n   \t\tvec2 uv \x3d $uv0.xy - uv01;\n\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\n\n   \t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w*trafoScale;\n   \t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w*trafoScale;\n   \t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\n   \t\tgl_Position \x3d pos4;\n   \t\tvtc \x3d uv;\n\n   \t\tdepth \x3d (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n\n   \t}\n ]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n'}});
define("dojo/text!./LeafCardMaterial.xml ./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../../../webgl/Util".split(" "),function(Q,x,R,n,M,I,J,S){function v(){return K=(9301*K+49297)%233280,K/233280}var a=n.vec3,H=n.mat4,L=n.mat4d;n=function(y,f,q,E,d,e){x.basicMaterialConstructor(this,e);var l=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:4,type:5126,offset:12,stride:44,
normalized:!1},{name:"uv0",count:4,type:5126,offset:28,stride:44,normalized:!1}],N=S.getStride(l)/4;this.getAmbient=function(){return f};this.getDiffuse=function(){return q};this.getSpecular=function(){return E};this.getShininess=function(){return d};this.dispose=function(){};this.getTextureId=function(){return y};this.getOutputAmount=function(l){var g,a=0;for(g=0;l/6>g;g++)0===g%1&&(a+=6);l=a;for(g=a=0;l/6>g;g++)0===g%1&&(a+=6);return a*N};this.getVertexBufferLayout=function(){return l};this.reduce=
function(a,g){var l=a.position,y=a.normal;a=a.uv0;for(var c=[],b=[],O=[],d=0,e=0;e<l.length/6;e++)if(0===e%g)for(var f=0;6>f;f++)c[d]=l[6*e+f],b[d]=y[6*e+f],O[d]=a[6*e+f],d++;return{position:c,normal:b,uv0:O}};this.fillInterleaved=function(l,g,y,d,c,b){d=x.fill;var e=this.reduce(l.faces.indices,1),e=this.reduce(e,1),f=this.getOutputAmount(l.faces.indices.position.length);R.assert(f===e.position.length*N);var q=e.position,E=e.normal,A=e.uv0,e=l.vertexAttr.position.data,D=l.vertexAttr.normal.data,B=
l.vertexAttr.uv0.data,t=a.create();l=q.length/6;for(var f=b,w=a.createFrom(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=a.createFrom(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=0;l>n;++n){for(var h=a.create(),p=a.create(),k=[100,100,-100,-100],u=a.create(),m=0;6>m;++m){var z=6*n+m,F=3*q[z],G=3*E[z],z=2*A[z];h[0]+=e[F+0];h[1]+=e[F+1];h[2]+=e[F+2];p[0]+=D[G+0];p[1]+=D[G+1];p[2]+=D[G+2];G=B[z+0];z=B[z+1];k[0]=Math.min(k[0],G);k[1]=Math.min(k[1],z);k[2]=Math.max(k[2],G);k[3]=Math.max(k[3],
z);0===m&&a.set3(e[F+0],e[F+1],e[F+2],u)}h[0]/=6;h[1]/=6;h[2]/=6;p[0]/=6;p[1]/=6;p[2]/=6;h[0]+=.1*(2*v()-1);h[1]+=.1*(2*v()-1);h[2]+=.1*(2*v()-1);void 0!==g&&(L.multiplyVec3(g,u,u),L.multiplyVec3(g,h,h),L.multiplyVec3(y,p,p));a.add(h,t,t);a.max(w,h,w);a.min(r,h,r);k[0]+=.01;k[1]+=.01;k[2]-=.01;k[3]-=.01;for(m=0;4>m;m++)k[m]=Math.min(k[m],.99999);m=2*v()*Math.PI;u=1.41*a.dist(u,h);b+=d(h,0,c,b,void 0,3);b+=d(p,0,c,b,void 0,3);c[b++]=0;c[b++]=k[0];c[b++]=k[1];c[b++]=m;c[b++]=u;b+=d(h,0,c,b,void 0,3);
b+=d(p,0,c,b,void 0,3);c[b++]=0;c[b++]=k[2]+1;c[b++]=k[1];c[b++]=m;c[b++]=u;b+=d(h,0,c,b,void 0,3);b+=d(p,0,c,b,void 0,3);c[b++]=0;c[b++]=k[2]+1;c[b++]=k[3]+1;c[b++]=m;c[b++]=u;b+=d(h,0,c,b,void 0,3);b+=d(p,0,c,b,void 0,3);c[b++]=0;c[b++]=k[2]+1;c[b++]=k[3]+1;c[b++]=m;c[b++]=u;b+=d(h,0,c,b,void 0,3);b+=d(p,0,c,b,void 0,3);c[b++]=0;c[b++]=k[0];c[b++]=k[3]+1;c[b++]=m;c[b++]=u;b+=d(h,0,c,b,void 0,3);b+=d(p,0,c,b,void 0,3);c[b++]=0;c[b++]=k[0];c[b++]=k[1];c[b++]=m;c[b++]=u}t[0]/=l;t[1]/=l;t[2]/=l;g=a.create();
a.add(w,r,g);a.scale(g,.5,g);b=a.create();a.subtract(w,r,b);b[0]=Math.abs(b[0])/2;b[1]=Math.abs(b[1])/2;b[2]=Math.abs(b[2])/2;q=a.create(t);q[1]-=(w[1]-r[1])/3;w=a.create();r=a.create();e=a.create();E=[a.create(),a.create(),a.create(),a.create()];t=[0,0,0,0];A=H.create();for(n=0;l>n;++n){a.set3(c[f],c[f+1],c[f+2],e);a.subtract(e,q,w);a.normalize(w,w);r=a.subtract(e,g,r);a.normalize(r,r);B=Math.abs(a.dot(r,[1,0,0]));m=Math.abs(a.dot(r,[0,1,0]));D=Math.abs(a.dot(r,[0,0,1]));B=B*Math.abs(g[0]-e[0])/
b[0];B+=m*Math.abs(g[1]-e[1])/b[1];B+=D*Math.abs(g[2]-e[2])/b[2];for(m=0;4>m;m++)H.identity(A),H.rotate(A,.8*(2*v()-1),[0,1,0],A),H.rotate(A,.8*(2*v()-1),[1,0,0],A),H.multiplyVec3(A,w,E[m]),t[m]=.5+.5*B-.2*(2*v()-1);D=.8+.3*(2*v()-1);for(m=0;6>m;++m){var C;switch(m){case 0:C=0;break;case 1:C=1;break;case 2:C=2;break;case 3:C=2;break;case 4:C=3;break;case 5:C=0}f+=3;f+=d(E[C],0,c,f,y,3);c[f++]=t[C];f+=3;c[f++]*=D}}};this.intersect=function(){};this.getGLMaterials=function(){return{color:T,depthShadowMap:U,
normal:void 0,depth:P,highlight:void 0}};this.getAllTextureIds=function(){return[y]}};var T=function(a,f,q){x.basicGLMaterialConstructor(this,a);var y=M.TRANSPARENT_MATERIAL,d=f.get("leafCard");x.singleTextureGLMaterialConstructor(this,q,{textureId:a.getTextureId()});this.beginSlot=function(g){return y===g};this.getProgram=function(){return d};var e=a.getAmbient(),l=a.getDiffuse(),n=a.getSpecular(),v=a.getShininess();this.bind=function(g,a){g.bindProgram(d);this.bindTexture(g,d);d.setUniform3fv("ambient",
e);d.setUniform3fv("diffuse",l);d.setUniform3fv("specular",n);d.setUniform1f("shininess",v);d.setUniform1f("trafoScale",1);g.setBlendingEnabled(!1);g.setDepthTestEnabled(!0)};this.release=function(g){};this.bindView=function(g,a){x.bindView(a.origin,a.view,d);x.bindCamPos(a.origin,a.viewInvTransp,d)};this.bindInstance=function(a,l){d.setUniformMatrix4fv("model",l.transformation);d.setUniformMatrix4fv("modelNormal",l.transformationNormal);a=l.transformation;d.setUniform1f("trafoScale",(Math.sqrt(a[0]*
a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},P=function(a,f,q,n){x.basicGLMaterialConstructor(this,a);var d=M.TRANSPARENT_MATERIAL,e=null==n?f.get("leafCardDepth"):f.get("leafCardDepthShadowMap");x.singleTextureGLMaterialConstructor(this,q,{textureId:a.getTextureId()});this.beginSlot=function(a){return d===a};this.getProgram=function(){return e};this.bind=function(a,d){a.bindProgram(e);
this.bindTexture(a,e);e.setUniform2fv("nearFar",d.nearFar)};this.release=function(a){};this.bindView=function(a,d){x.bindView(d.origin,d.view,e)};this.bindInstance=function(a,d){e.setUniformMatrix4fv("model",d.transformation);a=d.transformation;e.setUniform1f("trafoScale",(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},U=function(a,f,q){P.call(this,a,f,q,!0)};n.loadShaders=
function(a,f,q,n){a._parse(Q);var d=new I(n,a.vertexShaderLeafCard,a.fragmentShaderLeafCard,J.Default3D),e=f.get("fsDepthTextured");f=f.get("fsDepthTexturedShadowMap");e=new I(n,a.vertexShaderLeafCardDepth,e.source,J.Default3D,e.defines);a=new I(n,a.vertexShaderLeafCardDepth,f.source,J.Default3D,f.defines);q.add("leafCard",d);q.add("leafCardDepth",e);q.add("leafCardDepthShadowMap",a)};var K=1234;return n});